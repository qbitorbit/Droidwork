# Create all directories
mkdir -p ~/.deepagents/agent/skills/confluence/mcp_server
mkdir -p ~/.deepagents/agent/skills/confluence/scripts
mkdir -p ~/.deepagents/agent/skills/confluence/resources/prompts

# Create empty __init__.py files
touch ~/.deepagents/agent/skills/confluence/mcp_server/__init__.py
touch ~/.deepagents/agent/skills/confluence/scripts/__init__.py

# Verify
echo "=== Directory structure created ===" 
find ~/.deepagents/agent/skills/confluence/ -type f -o -type d | sort


cd ~/deepagents
source venv/bin/activate
pip install -r ~/.deepagents/agent/skills/confluence/mcp_server/requirements.txt



cat > ~/.deepagents/agent/skills/confluence/mcp_server/__init__.py << 'EOF'
"""
Confluence MCP Server Package
"""

from .confluence_client import ConfluenceClient, PageContent, SearchResult

__all__ = ["ConfluenceClient", "PageContent", "SearchResult"]
EOF

echo "âœ… __init__.py updated"


cd ~/deepagents
source venv/bin/activate
python ~/.deepagents/agent/skills/confluence/mcp_server/test_import.py


Check deepagents-cli MCP Configuration

echo "=== Looking for deepagents config files ===" && \
find ~/deepagents -name "*.yaml" -o -name "*.yml" -o -name "*.json" -o -name "config*.py" 2>/dev/null | head -20 && \
echo "" && \
echo "=== Checking common config locations ===" && \
ls -la ~/deepagents/libs/deepagents-cli/deepagents_cli/ 2>/dev/null | head -10 && \
echo "" && \
echo "=== Checking .deepagents directory ===" && \
ls -la ~/.deepagents/ 2>/dev/null

curl -s https://raw.githubusercontent.com/langchain-ai/deepagents/master/libs/deepagents-cli/deepagents_cli/skills/__init__.py

curl -s https://raw.githubusercontent.com/langchain-ai/deepagents/master/libs/deepagents-cli/deepagents_cli/skills/middleware.py

cd ~/deepagents && source venv/bin/activate && python -c "from mcp import ClientSession; print('MCP Client available')" 2>/dev/null || echo "Need to check MCP client API"

cd ~/deepagents && source venv/bin/activate && python ~/.deepagents/agent/skills/confluence/mcp_client.py

cd ~/deepagents && source venv/bin/activate && env -u http_proxy python ~/.deepagents/agent/skills/confluence/mcp_client.py

grep -n "def create_agent_with_config" ~/deepagents/libs/deepagents-cli/deepagents_cli/agent.py
grep -n "tools" ~/deepagents/libs/deepagents-cli/deepagents_cli/agent.py | head -20

grep -rn "create_agent_with_config" ~/deepagents/libs/deepagents-cli/deepagents_cli/ | grep -v ".pyc"

sed -n '280,320p' ~/deepagents/libs/deepagents-cli/deepagents_cli/main.py

# Backup original file
cp ~/deepagents/libs/deepagents-cli/deepagents_cli/main.py ~/deepagents/libs/deepagents-cli/deepagents_cli/main.py.backup

# Show the exact line numbers we need to modify
grep -n "tools = \[http_request, fetch_url\]" ~/deepagents/libs/deepagents-cli/deepagents_cli/main.py

cd ~/deepagents && source venv/bin/activate && env -u http_proxy deepagents

cd ~/.deepagents/agent/skills/confluence
cp mcp_client.py mcp_client.py.backup
cp mcp_server/confluence_client.py mcp_server/confluence_client.py.backup

# ~/deepagents/.env
CONFLUENCE_MULTI_MODEL=false   # Set to true to enable routing


cd ~/deepagents
source venv/bin/activate
env -u http_proxy python ~/.deepagents/agent/skills/confluence/mcp_client.py

To Rollback (if issues)

cp ~/.deepagents/agent/skills/confluence/mcp_client.py.backup ~/.deepagents/agent/skills/confluence/mcp_client.py

cd ~/deepagents
source venv/bin/activate
env -u http_proxy python -c "
import sys
sys.path.insert(0, '/Users/quantum/.deepagents/agent/skills/confluence')
from mcp_client import ConfluenceMCPClientSync
client = ConfluenceMCPClientSync()
result = client.call_tool('confluence_get_page_images', {'params': {'page_id': '187036437'}})
print('Type:', type(result))
print('Result:', result[:2000])
"
